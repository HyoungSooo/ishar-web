{% extends "layout.html.j2" %}
{%- macro render_field(field) -%}
                    {{ field(**kwargs) | safe }}
    {%- if field.errors %}
                <ul class="field-errors">
        {%- for error in field.errors %}
                    <li>
                        {{ error }}
                    </li>
        {%- endfor %}
                </ul>
    {%- endif %}
{%- endmacro -%}
{%- macro display_align(align) -%}
    {%- if align <= -1000 -%}
        Very Evil
    {%- elif align > -1000 and align <= -500 -%}
        Evil
    {%- elif align > -500 and align <= -250 -%}
        Slightly Evil
    {%- elif align > -250 and align < 250 -%}
        Neutral
    {%- elif align >= 250 and align < 500 -%}
        Slightly Good
    {%- elif align >= 500 and align < 1000 -%}
        Good
    {%- elif align >= 1000 %}
        Very Good
    {%- else -%}
        Un-Aligned Alien
    {%- endif -%}
{%- endmacro -%}
{%- macro display_class(class) -%}
    {%- if class == 'WARRIOR' -%}
        mighty warrior
    {%- elif class == 'ROGUE' -%}
        stealthy rogue
    {%- elif class == 'CLERIC' -%}
        pious cleric
    {%- elif class == 'MAGICIAN' -%}
        fearsome mage
    {%- elif class == 'NECROMANCER' -%}
        shadowy necromancer
    {%- else -%}
        classless curiousity
    {%- endif -%}
{%- endmacro -%}
{%- if player %}
    {%- if player.true_level >= 26 %}
        {%- set player_type = 'God' %}
        {%- set css_prefix  = 'god' %}
    {%- elif player.true_level == 25 %}
        {%- set player_type = 'Forger' %}
        {%- set css_prefix  = 'forger' %}
    {%- elif player.true_level == 24 %}
        {%- set player_type = 'Eternal' %}
        {%- set css_prefix  = 'eternal' %}
    {%- elif player.true_level == 23 %}
        {%- set player_type = 'Artisan' %}
        {%- set css_prefix  = 'artisan' %}
    {%- elif player.true_level == 22 %}
        {%- set player_type = 'Immortal' %}
        {%- set css_prefix  = 'immortal' %}
    {%- elif player.true_level == 21 %}
        {%- set player_type = 'Consort' %}
        {%- set css_prefix  = 'consort' %}
    {%- elif player.flags[45].value == 1 %}
        {%- set player_type = 'Survival' %}
        {%- if player.is_deleted == 1 %}
            {%- set css_prefix  = 'dead' %}
        {%- else %}
            {%- set css_prefix  = 'survival' %}
        {%- endif %}
    {%- else %}
        {%- set player_type = 'Classic' %}
        {%- set css_prefix  = 'regular' %}
    {%- endif %}
    {%- set player_title = player.title | replace('%s','<strong class="' + css_prefix + '-player"><a title="' + player.name + '" href="' + url_for('show_player', player_name=player.name) + '">' + player.name + '</a></strong>') | safe %}
    {%- set player_phrase           = 'is' %}
    {%- set player_phrase_own       = 'are' %}
    {%- set player_phrase_owns      = 'has' %}
    {%- if player.sex == 1 %}
        {%- set player_gender       = 'he' %}
        {%- set player_gender_own   = 'his' %}
    {%- elif player.sex == 2 %}
        {%- set player_gender       = 'she' %}
        {%- set player_gender_own   = 'her' %}
    {%- else %}
        {%- set player_gender       = 'they' %}
        {%- set player_gender_own   = 'their' %}
        {%- set player_phrase       = 'are' %}
        {%- set player_phrase_owns  = 'have' %}
    {%- endif %}
    {%- if player.is_deleted == 1 %}
        {%- set player_phrase       = 'was' %}
        {%- set player_phrase_own   = 'were' %}
        {%- set player_phrase_owns  = 'had' %}
    {%- endif %}
{%- endif %}
{%- block title %}
    {%- if player -%}
        Player: {{ player.name }}
    {%- else -%}
        Player Not Found
    {%- endif -%}
{%- endblock %}
{%- block header -%}
    {%- if player -%}
        Player: <span class="{{ css_prefix }}-player">{{ player.name }}</span>
    {%- else -%}
        Player Not Found
    {%- endif %}
{%- endblock %}
{%- block content %}
    {%- if player_search_form is defined %}
                <form method="post" action="{{ url_for('search_player') }}" id="player-search-form">
                    {{ render_field(player_search_form.player_search_name) }}
                    {{ player_search_form.csrf_token }}
                    {{ render_field(player_search_form.submit) }}
                </form>
    {%- endif %}
    {%- if player %}
                <h3>
                    {{ player_title }}
                </h3>
                <p>
                    {{ player.name | title | safe }} {{ player_phrase }} a {{ display_class(player.class.class_name) }} of {{ player.race.race_name | replace('_', '-') | lower | safe }} origin.
                    <br>
                    {{ player_gender | title }} {{ player_phrase }} a <span class="{{ player_type | lower }}-player">{{ player_type }}</span> character.
                    <br>
                    {{ player_gender | title }} {{ player_phrase }} level {{ player.level }} and {{ player_phrase_owns }} remorted {{ player.remorts }} times.
                    <br>
                    {{ player_gender | title }} {{ player_phrase_owns }} accumulated {{ player.total_renown }} renown.
                    <br>
                    {{ player_gender_own | title }} alignment {{ player_phrase }} {{ display_align(player.align) }} ({{ player.align }}).
                    <br>
                    {%- if player.is_deleted != 1 and not player.true_level > 20 %}
                    {{ player_gender | title }} {{ player_phrase_owns }} died {{ player.deaths }} time{%- if player.deaths != 1 -%}s{%- endif -%}.
                    {%- endif %}
                </p>
                {%- if player.quests_completed > 0 %}
                <h3>
                    Quests
                </h3>
                <ul>
                {%- for quest in player.quests %}
                  {%- if quest.value == 1 %}
                    <li>
                        {{ quest.quest.display_name }}
                        {%- if quest.quest.completion_message is defined and quest.quest.completion_message != '' %}
                        <ul>
                            <li>
                                {{ quest.quest.completion_message }}
                            </li>
                        </ul>
                        {%- endif %}
                    </li>
                  {%- endif %}
                {%- endfor %}
                </ul>
                {%- endif %}
                {%- if player.true_level >= 5 or player.is_deleted == 1 %}
                <h3>
                    Statistics
                </h3>
                <table>
                    <tr>
                        <th>
                            Strength
                        </th>
                        <th>
                            Agility
                        </th>
                        <th>
                            Endurance
                        </th>
                        <th>
                            Willpower
                        </th>
                        <th>
                            Focus
                        </th>
                        <th>
                            Perception
                        </th>
                    </tr>
                    <tr>
                        <td>
                            {{ player.curr_strength }}
                        </td>
                        <td>
                            {{ player.curr_agility }}
                        </td>
                        <td>
                            {{ player.curr_endurance }}
                        </td>
                        <td>
                            {{ player.curr_willpower }}
                        </td>
                        <td>
                            {{ player.curr_focus }}
                        </td>
                        <td>
                            {{ player.curr_perception }}
                        </td>
                    </tr>
                </table>
                {%- endif %}
                <p>
                    {%- set seconds_since_birth = now | int - player.birth | int %}
                    {{ player_gender | title }} was born {{ seconds_since_birth | seconds2human_time }} ago.
                    <br>
                    {{ player_gender | title }} last logged in {{ player.logon | unix2human_time }}.
                    <br>
                    {{ player_gender | title }} last logged out {{ player.logout | unix2human_time }}.
                    <br>
                    {{ player_gender | title }} {{ player_phrase_owns }} played for {{ player.online | seconds2human_time }}.
                </p>
    {%- endif %}
                <p>
                    <a href="{{ url_for('portal') }}">
                        <img src="{{ url_for('static', filename='back.gif') }}" alt="Back to Player Portal">
                    </a>
                </p>
{%- endblock %}
