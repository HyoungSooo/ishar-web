{% extends "layout.html.j2" %}
{% block title %}Portal{% endblock %}
{% block header %}Welcome{% if current_user.account_name is defined %}, {{ current_user.account_name | title | safe }}{% endif %}!{% endblock %}
{%- block content %}
                {%- if current_user.players is defined and current_user.players is iterable and current_user.players|length > 0 %}
                <h3>
                    {{ current_user.players | length }} character{% if current_user.players|length != 1 %}s{% endif %}:
                </h3>
                <br>
                <table id="players">
                    <tr>
                        <th>
                            Name
                        </th>
                        <th>
                            Class
                        </th>
                        <th>
                            Level
                        </th>
                        <th>
                            Remorts
                        </th>
                        <th>
                            Renown (Total)
                        </th>
                        <th>
                            Quests
                        </th>
                        <th>
                            Challenges
                        </th>
                        <th>
                            Deaths
                        </th>
                        <th>
                            Type
                        </th>
                    </tr>
                    {%- for player in current_user.players %}
                        {%- if player.true_level >= 26 %}
                            {%- set player_type = 'God' %}
                            {%- set css_prefix  = 'god' %}
                        {%- elif player.true_level == 25 %}
                            {%- set player_type = 'Forger' %}
                            {%- set css_prefix  = 'forger' %}
                        {%- elif player.true_level == 24 %}
                            {%- set player_type = 'Eternal' %}
                            {%- set css_prefix  = 'eternal' %}
                        {%- elif player.true_level == 23 %}
                            {%- set player_type = 'Artisan' %}
                            {%- set css_prefix  = 'artisan' %}
                        {%- elif player.true_level == 22 %}
                            {%- set player_type = 'Immortal' %}
                            {%- set css_prefix  = 'immortal' %}
                        {%- elif player.true_level == 21 %}
                            {%- set player_type = 'Consort' %}
                            {%- set css_prefix  = 'consort' %}
                        {%- elif player.flags[45].value == 1 %}
                            {%- set player_type = 'Survival' %}
                            {%- if player.is_deleted == 1 %}
                                {%- set css_prefix  = 'dead' %}
                            {%- else %}
                                {%- set css_prefix  = 'survival' %}
                            {%- endif %}
                        {%- else %}
                            {%- set player_type = 'Classic' %}
                            {%- set css_prefix  = 'regular' %}
                        {%- endif %}
                        {%- set player_title = player.title | replace('%s','<strong class="' + css_prefix + '-player"><a title="' + player.name + '" href="' + url_for('show_player', player_name=player.name) + '">' + player.name + '</a></strong>') | safe %}
                    <tr>
                        <td>
                            <span title="{{ player.name | title | safe }} (Born {{ player.birth | unix2human_time }})">
                                {{ player_title | safe }}
                            </span>
                        </td>
                        <td>
                            <span title="Class: {{ player.class.class_name | replace('_', '-') | title | safe }}">
                                {{ player.class.class_name | replace('_', '-') | title | safe }}
                            </span>
                        </td>
                        <td>
                            <span title="Level: {{ player.level }}">
                                {{ player.level }}
                            </span>
                        </td>
                        <td>
                            <span title="Remorts: {{ player.remorts }}">
                                {{ player.remorts }}
                            </span>
                        </td>
                        <td>
                            <span title="Renown: {{ player.renown }} ({{ player.total_renown }})">
                                {{ player.renown }} ({{ player.total_renown }})
                            </span>
                        </td>
                        <td>
                            <span title="Quests: {{ player.quests_completed }}">
                                {{ player.quests_completed }}
                            </span>
                        </td>
                        <td>
                            <span title="Challenges: {{ player.challenges_completed }}">
                                {{ player.challenges_completed }}
                            </span>
                        </td>
                        <td>
                            <span title="Deaths: {{ player.deaths }}">
                                {{ player.deaths }}
                            </span>
                        </td>
                        <td>
                            <span title="Type: {{ player_type }}" class="{{ css_prefix }}-player">
                                {{ player_type }}
                            </span>
                        </td>
                    </tr>
                    {%- endfor %}
                </table>
                <br>
                {%- else %}
                <h3>
                    You have not created any players yet!
                </h3>
                {%- endif %}
                <p class="bottom-portal-link">
                    <a title="Challenges" href="{{ url_for('challenges') }}">
                        Challenges
                    </a>
                    |
                    <a title="Change Password" href="{{ url_for('change_password') }}">
                        Change Password
                    </a>
                    |
                    <a title="Leader Board" href="{{ url_for('leaderboard') }}">
                        Leader Board
                    </a>
                    |
                    <a title="Log Out" href="{{ url_for('logout') }}">
                        Log Out
                    </a>
                </p>
                {%- if is_admin is defined and is_admin == True %}
                <p class="bottom-portal-link">
                    <a title="Administration Portal" href="{{ url_for('admin_portal') }}">Administration</a>
                </p>
                {%- endif %}
{%- endblock %}
