{% extends "layout.html.j2" %}
{% block meta_title %}Manage Account ({{ current_user.account_name | title | safe }}){% endblock meta_title %}
{% block meta_description %}Manage your Ishar MUD account{% endblock%}
{% block meta_url %}{{ url_for('manage_account', _external=True) }}{% endblock meta_url %}">
{% block title %}Manage Account ({{ current_user.account_name | title | safe }}){% endblock %}
{% block header %}Manage Account ({{ current_user.account_name | title | safe }}){% endblock %}
{%- block content %}
            <h3>
                <strong>
                    Welcome to your account page!
                </strong>
            </h3>
            <p>
                You can view information about, and manage, your Ishar MUD account from here.
            </p>
            <div id="account-details">
                <ul>
                    <li title="You created your account on {{ current_user.created_at.strftime('%A, %B %d, %Y @ %H:%M:%S %Z') }}">
                        You created your account on:
                        <ul>
                            <li>
                                 {{ current_user.created_at.strftime('%A, %B %d, %Y @ %H:%M:%S %Z') }}
                            </li>
                        </ul>
                    </li>
                    <li title="Change your password">
                        You can <a href="{{ url_for('change_password') }}">change your password here</a>
                    </li>
                    <li title="View your players">
                        You can <a href="{{ url_for('portal') }}">view your players here</a>
                    </li>
                </ul>
            </div>
            <h4 title="Upgrades">
                Upgrades
            </h4>
    {%- if current_user.upgrades is defined and current_user.upgrades is iterable and current_user.upgrades | selectattr('amount', '>', 0) | list | length > 0 %}
            <div id="essence-upgrades">
                <ul>
        {%- for upgraded in current_user.upgrades | selectattr('amount', '>', 0) %}
                    <li title="{{ upgraded.upgrade.name }}{% if upgraded.amount > 1 %} (x{{ upgraded.amount}}){% endif %}">
                        {{ upgraded.upgrade.name }}
                        {%- if upgraded.amount > 1 %} (x{{ upgraded.amount}}){% endif %}
                    </li>
        {%- endfor %}
                </ul>
            </div>
    {%- else %}
            <ul>
                <li title="You have not purchased any upgrades.">
                    <i>You have not purchased any upgrades.</i>
                </li>
            </ul>
    {%- endif %}
            <h4>
                Essence
            </h4>
            <p>
                "Essence" are the rewards points earned for your account during the season!
            </p>
            <p>
                Essence is preserved across seasons, and can be spent at any time
                <a href="{{ url_for('shop') }} ">at the Essence Shop</a>
                or by typing <code>shop</code> in-game, once logged in.
            </p>
        {%- if current_user is defined and current_user.seasonal_points is defined and current_user.seasonal_earned is defined %}
            <div id="essence-balance">
                <ul>
                    <li title="You currently have: {{ current_user.seasonal_points }} essence.">
                        You currently have: {{ display_essence(current_user.seasonal_points) }}.
                    </li>
                    <li title="This season, you have earned: {{ current_user.seasonal_earned }} essence.">
                        This season, you have earned: {{ display_essence(current_user.seasonal_earned) }}.
                    </li>
                    <li title="Spend your essence at the Shop">
                        You can <a href="{{ url_for('shop') }}">spend your essence at the Shop</a>
                    </li>
                </ul>
            </div>
        {%- endif %}
{%- endblock %}
