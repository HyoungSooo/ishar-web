{%- set page = 'challenges' -%}
{% extends "layout.html.j2" %}
{%- set challenges_pre  = 'Challenges' -%}
{%- if challenges is defined and challenges is iterable and challenges | length > 0 %}
    {%- set challenges_completed    = challenges | selectattr('winner_desc', '!=', '') | list | length %}
    {%- set challenges_total        = challenges | list | length %}
    {%- set challenges_title        = challenges_pre + ' (' + challenges_completed | string + '/' + challenges_total | string + ')'  %}
{%- endif %}
{% block meta_title %}Challenges{% endblock meta_title %}
{% block meta_description %}Challenges, winners, and rewards currently available.{% endblock %}
{% block meta_url %}{{ url_for('challenges', _external=True) }}{% endblock meta_url %}">
{% block title %}{{ challenges_title }}{% endblock %}
{% block header %}{{ challenges_title }}{% endblock %}
{%- macro display_tier(reward_tier) -%}
    {%- set tiers   = { 9: 'SS', 8: 'SS', 7: 'SS', 6: 'S', 5: 'A', 4: 'B', 3: 'C', 2: 'D', 1: 'F' } -%}
    {{- tiers[reward_tier] -}}
{%- endmacro -%}
{%- block content %}
    {%- if challenges is defined and challenges is iterable and challenges | length > 0 %}
            <table id="challenges">
                <tr>
                    <th title="Find and Kill">
                        Find and Kill
                    </th>
                    <th title="People">
                        People
                    </th>
                    <th title="Level">
                        Level
                    </th>
                    <th title="Reward">
                        Reward
                    </th>
                    <th title="Completed">
                        Completed
                    </th>
                </tr>
        {%- for challenge in challenges %}
                <tr>
                    <td title="{{ challenge.mob_name }} {%- if challenge.is_completed %} (Completed){% endif %}" {%- if challenge.is_completed %} class="challenge-completed"{% endif %}>
                        {{ challenge.mob_name }}
                    </td>
                    <td title="People: {{ challenge.adj_people }}">
                        {{ challenge.adj_people }}
                    </td>
                    <td title="Level: {{ challenge.adj_level }}">
                        {{ challenge.adj_level }}
                    </td>
                    <td title="Reward: {{ display_tier(challenge.orig_tier) }}{%- if challenge.is_completed %} {{ display_tier(challenge.adj_tier) }}{% endif %}">
                        {{ display_tier(challenge.orig_tier) }}{%- if challenge.is_completed %} ({{ display_tier(challenge.adj_tier) }}){% endif %}
                    </td>
                    <td>
            {%- if challenge.is_completed %}
                {%- set challenge_winners   = challenge.winner_desc.replace(' ', '').split(',') %}
                {%- for challenge_winner in challenge_winners %}
                        <a href="{{ url_for('show_player', player_name=challenge_winner) }}" title="Player: {{ challenge_winner }}">{{ challenge_winner | title | safe }}</a>
                    {%- if not loop.last %},{%- endif %}
                {%- endfor %}
            {%- endif %}
                    </td>
                </tr>
        {%- endfor %}
            </table>
    {%- endif %}
{%- endblock %}
